import { useState, useEffect, useCallback } from 'react';\nimport socketService from '../services/socketService';\n\nexport const useMessageStatus = () => {\n  const [messageStatuses, setMessageStatuses] = useState(new Map());\n  const [isPartnerOnline, setIsPartnerOnline] = useState(true);\n\n  // Update message status\n  const updateMessageStatus = useCallback((messageId, status, additionalData = {}) => {\n    setMessageStatuses(prev => {\n      const newMap = new Map(prev);\n      newMap.set(messageId, {\n        status,\n        timestamp: Date.now(),\n        ...additionalData\n      });\n      return newMap;\n    });\n  }, []);\n\n  // Get message status\n  const getMessageStatus = useCallback((messageId) => {\n    return messageStatuses.get(messageId) || { status: 'sending' };\n  }, [messageStatuses]);\n\n  // Handle message status updates from server\n  useEffect(() => {\n    const handleStatusUpdate = (data) => {\n      const { messageId, status, icon, color } = data;\n      updateMessageStatus(messageId, status, { icon, color });\n    };\n\n    const handleNetworkIssue = () => {\n      setIsPartnerOnline(false);\n      // Update all pending messages to network issue\n      setMessageStatuses(prev => {\n        const newMap = new Map();\n        for (const [msgId, msgData] of prev) {\n          if (msgData.status === 'sent' || msgData.status === 'sending') {\n            newMap.set(msgId, {\n              ...msgData,\n              status: 'network_issue'\n            });\n          } else {\n            newMap.set(msgId, msgData);\n          }\n        }\n        return newMap;\n      });\n    };\n\n    const handlePartnerReconnect = () => {\n      setIsPartnerOnline(true);\n      // Update network issue messages back to sent\n      setMessageStatuses(prev => {\n        const newMap = new Map();\n        for (const [msgId, msgData] of prev) {\n          if (msgData.status === 'network_issue') {\n            newMap.set(msgId, {\n              ...msgData,\n              status: 'sent'\n            });\n          } else {\n            newMap.set(msgId, msgData);\n          }\n        }\n        return newMap;\n      });\n    };\n\n    socketService.onMessageStatusUpdate(handleStatusUpdate);\n    socketService.onNetworkIssue(handleNetworkIssue);\n    \n    // Listen for partner online/offline events\n    if (socketService.socket) {\n      socketService.socket.on('partner-offline', handleNetworkIssue);\n      socketService.socket.on('partner-online', handlePartnerReconnect);\n    }\n\n    return () => {\n      if (socketService.socket) {\n        socketService.socket.off('message-status-update', handleStatusUpdate);\n        socketService.socket.off('network-issue', handleNetworkIssue);\n        socketService.socket.off('partner-offline', handleNetworkIssue);\n        socketService.socket.off('partner-online', handlePartnerReconnect);\n      }\n    };\n  }, [updateMessageStatus]);\n\n  return {\n    messageStatuses,\n    updateMessageStatus,\n    getMessageStatus,\n    isPartnerOnline\n  };\n};